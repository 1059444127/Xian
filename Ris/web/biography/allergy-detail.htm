<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Allergy Detail</title>
		<link href="../css/default.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="../js/jsx.js"></script>
		<script type="text/javascript" src="../js/jsml.js"></script>
		<script type="text/javascript" src="../js/ui.js"></script>
		<script type="text/javascript" src="../js/ris.js"></script>
		<script type="text/javascript" src="../js/preview.js"></script>
		<script type="text/javascript" src="../js/layout.js"></script>
		<script type="text/javascript" >
			var data = {};
			var errorProvider = new ErrorProvider();
			var canEdit = false;

			function onBodyLoad()
			{
				if(!Ris)
					return;

				try
				{
					var context = Ris.getHealthcareContext();
					if (context == null)
					{
						Field.setValue($("myForm"), "");
						return;
					}

					canedit = Ris.getTag("ReadOnly") != "true";
					initAllergyTable(context);
				}
				catch(e)
				{
					var message = "Failed to load editor page.  An exception occurred in the script. Error name: " + e.name + ". Error message: " + e.message;
					Field.setValue($("myForm"), message);
				}
			}

			function initAllergyTable(allergyContext)
			{
				var table = Table.createTable($("allergyTable"), 
						{ editInPlace: canEdit, flow: true, checkBoxes: canEdit, empty: Table.defaultEmptyOption },
						[
							{	label: "Allergen Type",
								cellType: "text",
								getValue: function(item) { return item.AllergenType.Value; },
								getError: function(item) { return null; }
							},
							{	label: "Description",
								cellType: "text",
								getValue: function(item) { return item.AllergenDescription; },
								getError: function(item) { return null; }
							},
							{	label: "Severity",
								cellType: "text",
								getValue: function(item) { return item.Severity ? item.Severity.Value; },
								getError: function(item) { return null; }
							},
							{	label: "Reaction",
								cellType: "text",
								getValue: function(item) { return item.Reaction; },
								getError: function(item) { return null; }
							},
							{	label: "Sensitivity Type",
								cellType: "text",
								getValue: function(item) { return item.SensitivityType.Value; },
								getError: function(item) { return null; }
							},
							{	label: "Onset Time",
								cellType: "datetime",
								getValue: function(item) { return item.OnsetTime; },
								getError: function(item) { return null; }
							},
							{	label: "Reported Time",
								cellType: "datetime",
								getValue: function(item) { return item.ReportedTime; },
								getError: function(item) { return null; }
							},
							{	label: "Reported By",
								cellType: "text",
								getValue: function(item) { return item.ReportedByFamilyName + ", " + item.ReportedByGivenName; },
								getError: function(item) { return null; }
							},
							{	label: "Relationship",
								cellType: "text",
								getValue: function(item) { return item.ReportedByRelationshipType.Value; },
								getError: function(item) { return null; }
							}
						]);

				table.initAddDeleteButtons(canEdit, "Delete selected patient allergy");
				table.errorProvider = errorProvider;
				table.bindItems(allergyContext.Allergies);
			}

			function saveData()
			{
				// Not yet implemented
				Ris.setTag("???", JSML.create(data, "data"));
			}
		</script>
	</head>
	<body onload="javascript: onBodyLoad()">
		<form id="myForm">
			<table id="allergyTable" border="1" width="100%">
				<tr><td></td></tr>
			</table>
		</form>
	</body>
</html>